@page
@using Share.Constant
@model Client.Pages.Product.IndexModel
@{
    bool isDataAdded = ViewData["DataAdded"] != null && (bool)ViewData["DataAdded"];
    bool isDataDeleted = ViewData["DataDeleted"] != null && (bool)ViewData["DataDeleted"];
    bool hasValidationErrors = !ViewData.ModelState.IsValid;

}
<!-- notification add successfully -->
@if (isDataAdded)
{
    <div class="alert alert-success alert-dismissible fade show" class="success-message-add" style="z-index: 1000;">
        <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="me-2"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
        <strong>Add successfully!</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="btn-close" onclick="hideNotification()">
        </button>
    </div>
}
<!-- END notification add successfully -->
<!-- notification delete successfully -->
@if (isDataDeleted)
{
    <div class="alert alert-success alert-dismissible fade show" class="success-message-delete" style="z-index: 1000;">
        <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="me-2"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
        <strong>Delete successfully!</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="btn-close" onclick="hideNotification()">
        </button>
    </div>
}
<!-- END notification delete successfully -->
<div class="container-fluid">
    <div class="row page-titles">
        <ol class="breadcrumb">
            <li class="breadcrumb-item-no-link">Setting/</li>
            <li class="breadcrumb-item-no-link">Product/</li>
            <li class="breadcrumb-item active">Index</li>
        </ol>
    </div>
    <!-- row -->
    <div class="modal fade" id="sendMessageModal">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="deleteForm" method="post" asp-page-handler="Delete" style="display:none;">
                        <input type="hidden" name="productId" id="productId" />
                        <input type="hidden" name="productId" id="pageIndex" />
                    </form>
                    <div class="card-action card-tabs mb-3">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" role="tab" id="import" >Import</button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" role="tab" id="export" >Export</button>
                            </li>
                        </ul>
                    </div>
                    <form class="comment-form" method="post" asp-page-handler="Add" enctype="multipart/form-data">
                        <div class="row">
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="text-black font-w600 form-label">Product Name<span class="required">*</span></label>
                                    <input type="text" class="form-control" asp-for="EditModel.Name">
                                    <span asp-validation-for="EditModel.Name" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="text-black font-w600 form-label">Image<span class="required">*</span></label>
                                    <input type="file" class="form-control" asp-for="UploadImage">
                                    <span asp-validation-for="UploadImage" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="text-black font-w600 form-label">Unit Price<span class="required">*</span></label>
                                    <input type="number" class="form-control" asp-for="EditModel.UnitPrice">
                                    <span asp-validation-for="EditModel.UnitPrice" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="text-black font-w600 form-label">Quantity Per Unit<span class="required">*</span></label>
                                    <input type="number" class="form-control" asp-for="EditModel.QuantityPerUnit">
                                    <span asp-validation-for="EditModel.QuantityPerUnit" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="text-black font-w600 form-label">Category:<span class="required">*</span></label>
                                    <select asp-for="EditModel.CategoryId" class="default-select  form-control wide">
                                        @foreach(var category in Model.Categories)
                                        {
                                            <option value="@category.Id">@category.Name</option>
                                        }
                                    </select>
                                    <span asp-validation-for="EditModel.CategoryId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-lg-6" id="supplierChoice">
                                <div class="mb-3">
                                    <label class="text-black font-w600 form-label">Supplier:</label>
                                    <select asp-for="EditModel.SupplierId" class="default-select  form-control wide" id="supplierId">
                                        <option value="-1">None</option>
                                        @foreach (var supplier in Model.Suppliers)
                                        {
                                            <option value="@supplier.Id">@supplier.SupplierName</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            @* <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="text-black font-w600 form-label">For Sell</label>
                                    <select asp-for="EditModel.ForSell" class="default-select  form-control wide">
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                            </div> *@
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="text-black font-w600 form-label">Available</label>
                                    <select asp-for="EditModel.IsAvailable" class="default-select  form-control wide">
                                        <option value="true">Yes</option>
                                        <option value="false">No</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="mb-3 mb-0">
                                    <input type="submit" value="Add" class="submit btn btn-primary" name="submit">
                                </div>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">List Product</h4>
                    <button type="button" class="btn btn-rounded btn-info" data-bs-toggle="modal" data-bs-target="#sendMessageModal" id="btn-supplier">
                        <span class="btn-icon-start text-info">
                            <i class="fa fa-plus color-info"></i>
                        </span>Add
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="display table" style="min-width: 845px">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Quantity Per Product</th>
                                    <th>Unit Price</th>
                                    <th>Category</th>
                                    <th>Supplier</th>
                                    <th>For Sell</th>
                                    <th>Available</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody class="table-group-divider">
                                @foreach (var item in Model.ViewModels)
                                {
                                    <tr>
                                        <td>@item.Stt</td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <img src="@item.GetImage" class="rounded-lg me-2" width="130" alt="">
                                            </div>
                                        </td>
                                        <td>@item.Name</td>
                                        <td>@item.QuantityPerUnit</td>
                                        <td>@item.UnitPrice</td>
                                        <td>@item.Category.Name</td>
                                        <td>@(item.Supplier != null ? item.Supplier.SupplierName : "")</td>
                                        <td>@(item.ForSell ? "Yes" : "No")</td>
                                        <td>@(item.IsAvailable ? "Yes" : "No")</td>
                                        <td>
                                            <div class="d-flex">
                                                <a asp-page="./Update" asp-route-id="@item.Id" class="btn btn-primary shadow btn-xs sharp me-1"><i class="fas fa-pencil-alt"></i></a>
                                                <a onclick="deleteProduct(@item.Id); return false;" class="btn btn-danger shadow btn-xs sharp"><i class="fa fa-trash"></i></a>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                }
                            </tbody>
                        </table>
                        <partial name="_Paging" model="@Model.Search" />
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let isImport = true;
    let importBtn = document.getElementById("import");
    let exportBtn = document.getElementById("export");
    let supplierChoice = document.getElementById("supplierChoice");
    let supplierId = document.getElementById("supplierId");
    importBtn.onclick = function () {
        importBtn.classList.add("active");
        exportBtn.classList.remove("active");
        isImport = true;
        supplierChoice.classList.add("d-block");
        supplierChoice.classList.remove("d-none");
        supplierId.options[0].disabled = true;
        supplierId.selectedIndex = 1;
    }
    exportBtn.onclick = function () {
        exportBtn.classList.add("active");
        importBtn.classList.remove("active");
        isImport = false;
        supplierChoice.classList.add("d-none")
        supplierChoice.classList.remove("d-block");
        supplierId.options[0].disabled = false;
        supplierId.selectedIndex = 0;
    }
    document.addEventListener("DOMContentLoaded", function () {
        // Kiểm tra nếu có lỗi xác thực
        var hasValidationErrors = @Html.Raw(Json.Serialize(hasValidationErrors));
        importBtn.click();
        // Nếu có lỗi, mở modal
        if (hasValidationErrors) {
            var modalElement = new bootstrap.Modal(document.getElementById('sendMessageModal'));
            modalElement.show();
        }
    });
    // scripts.js
    document.addEventListener('DOMContentLoaded', (event) => {
        // Tự động ẩn thông báo sau 5 giây
        setTimeout(hideNotification, 5000);
    });

    function hideNotification() {
        var notification = document.getElementsByClassName('success-message-add');
        if (notification) {
            // Dùng hiệu ứng mờ dần để ẩn thông báo
            notification.style.opacity = '0';
            // Sau khi hiệu ứng hoàn thành, ẩn hoàn toàn phần tử này
            setTimeout(() => {
                notification.style.display = 'none';
            }, 500); // Thời gian chờ tương ứng với transition của CSS
        }
        var notificationDelete = document.getElementsByClassName('success-message-delete');
        if (notificationDelete) {
            // Dùng hiệu ứng mờ dần để ẩn thông báo
            notificationDelete.style.opacity = '0';
            // Sau khi hiệu ứng hoàn thành, ẩn hoàn toàn phần tử này
            setTimeout(() => {
                notificationDelete.style.display = 'none';
            }, 500); // Thời gian chờ tương ứng với transition của CSS
        }
    }

    function deleteProduct(productId) {
        if (confirm("Are you sure you want to delete this product?")) {
            var form = document.getElementById("deleteForm");
            document.getElementById("productId").value = productId;
            document.getElementById("pageIndex").value = @Model.Search.Page.PageIndex;
            form.submit();
        }
    }
</script>
<style>
    .success-message {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        opacity: 1;
        transition: opacity 0.5s ease, right 0.5s ease;
        width: 400px; /* Độ rộng của thông báo */
        padding: 15px; /* Khoảng cách bên trong của thông báo */
        font-size: 16px; /* Cỡ chữ của thông báo */
    }
</style>